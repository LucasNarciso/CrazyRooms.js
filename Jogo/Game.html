<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo</title>
    <link rel="stylesheet" href="Style.css">
    <link rel="stylesheet" href="../GlobalStyle.css">

    <script id="scriptBase">
        
        //Info
        let info;
        if (window.self !== window.top) {
            // info = "A página está sendo aberta em um iframe.";
            info = "";
            setTimeout(iniciarGame, 100)
        } else {
            info = "O jogo não funciona aqui '-'";

            //ISecure
            document.getElementById('scriptBase').remove();
            setTimeout(()=>{window.location.href = "/MainGame.html"},1)
        }

        setTimeout(() => { 
            document.getElementById('info1').innerHTML = info;
        }, 100);

        function enviar(){
            let campo = document.querySelector('#campo')
            if(campo.value != ""){
                escreverNoTerminal('jogador', campo.value)
            }
            campo.value = "";
        }

        function limparTerminal(){
            document.querySelector('.ConteudoTerminal').innerHTML = ""
        }

        function iniciarGame(){
            let terminal = document.querySelector('.ConteudoTerminal')
            let campo = document.querySelector('#campo')

            campo.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById("botao").click();
            }
            });
            setTimeout(() => {
                escreverNoTerminal('jogo', 'Olá jogador! Bem vindo ao Crazy Rooms!');
                escreverNoTerminal('jogo', 'Gostaria de informar o seu nome? Ou podemos escolher pra você?', ["Informar meu nome", "Deixar que escolham"]);
            }, 1000);
        }

        function escreverNoTerminal(origem, texto, opcoes){
            let terminal = document.querySelector('.ConteudoTerminal')
            if(origem == 'jogo'){
                let idTexto = Math.random();
                let idOpts = Math.random();
                if(opcoes){
                    let opcoesHTML = opcoes.map((opcao,index)=>`${index+1}. ${opcao}`)

                    terminal.insertAdjacentHTML('beforeEnd',`<div class="mensagem escolha">
                        <p id="${idTexto}"></p>
                        <div class="opcoes" id="${idOpts}">
                            
                        </div>
                    </div>`)
                    escreveTexto(texto, idTexto)
                    escreveTexto(opcoesHTML, idOpts)
                }else{
                    terminal.insertAdjacentHTML('beforeEnd',`<div class="mensagem">
                        <p id="${idTexto}"></p>
                    </div>`)
                    escreveTexto(texto, idTexto)
                }
            }else if(origem == 'jogador'){
                terminal.insertAdjacentHTML('beforeEnd',`<div class="mensagem">
                    <p>> ${texto}</p>
                </div>`)
            }
        }

        async function escreveTexto(texto, idDestino){

            let textoSplit = []
            if(texto.split){
                textoSplit = texto.split('');
                for (let i = 0; i < textoSplit.length; i++) {
                    const char = textoSplit[i];
                    document.getElementById(idDestino).insertAdjacentHTML('beforeEnd',`${char}`)
                    await sleep(10)               
                }
            }else{
                for (let j = 0; j < texto.length; j++) {
                    textoSplit = texto[j].split('');
                    for (let i = 0; i < textoSplit.length; i++) {
                        const char = textoSplit[i];
                        document.getElementById(idDestino).insertAdjacentHTML('beforeEnd',`${char}`)
                        await sleep(10)               
                    }
                    document.getElementById(idDestino).insertAdjacentHTML('beforeEnd',`<br>`)
                }
            }

        }
        
        const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))

    </script>
</head>
<body>
    <div class="ContainerPrincipalJogo">
        <span id="info1"></span>
        <div class="ConteudoTerminal">
        </div>
        <div class="BarraTerminal">
            <input id="campo" type="text">
            <button id="botao" onclick="enviar()">ENVIAR</button>
        </div>
    </div>
</body>
</html>